<!DOCTYPE html><html lang="en"><head><title>src/server/mixin</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src/server/mixin"><meta name="groc-project-path" content="src/server/mixin.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/server/mixin.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="mixin">mixin</h1>

<p>Adds a set of new client-side development configuration methods to the GruntConfig class
provided by <code>thehelp-project</code>.</p></div></div><div class="code"><div class="wrapper"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">mixin</span><span class="p">(</span><span class="nx">GruntConfig</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">previous</span> <span class="o">=</span>
    <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">previousSetup</span> <span class="o">=</span> <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">previousSetup</span> <span class="o">||</span> <span class="p">[];</span>

  <span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">standardSetup</span><span class="p">;</span>
  <span class="nx">previous</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>

  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">standardSetup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="nx">parent</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">registerConnect</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">connect</span><span class="p">);</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerConnect</code> sets up two targets for the <code>grunt-contrib-connect</code>
task, which runs a basic file server. Two different targets are provided:</p>

<ul>
<li>test: On port 3001, this server will stop as soon as the grunt run stops,
which means that it is only useful for grunt-based testing.</li>
<li>keepalive: A server on 3000 that runs until explicitly stopped - good
for active development.</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerConnect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-connect&#39;</span><span class="p">,</span> <span class="nx">__dirname</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{</span>
      <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
          <span class="nx">port</span><span class="o">:</span> <span class="mi">3001</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">keepalive</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
          <span class="nx">port</span><span class="o">:</span> <span class="mi">3000</span><span class="p">,</span>
          <span class="nx">keepalive</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerMocha</code> pulls in <code>grunt-mocha</code> which uses <code>phantomjs</code>
and a custom bridge to run in-browser tests on the command line. You're
just responsible for the collection of <code>urls</code> to hit. You might consider using
the port 3001 urls available with the <code>connect</code> task above.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerMocha</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">urls</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Need to provide array of urls to registerMocha()!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">options</span><span class="p">.</span><span class="nx">reporter</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reporter</span> <span class="o">||</span> <span class="s1">&#39;Spec&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">run</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//default to allowing tests to run when they are ready</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">log</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//default to piping browser console output back to the command line</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-mocha&#39;</span><span class="p">,</span> <span class="nx">__dirname</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;mocha&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">options</span><span class="o">:</span> <span class="nx">options</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerOptimizeLibrary</code> uses <code>grunt-requirejs</code> to produce one concatenated file,
by default optimized as well.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerOptimize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*jshint maxcomplexity: 11 */</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">requirejsRegistered</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-requirejs&#39;</span><span class="p">,</span> <span class="nx">__dirname</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">requirejsRegistered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">config</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Need to provide options.config with requirejs options!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Need to provide options.name!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">standalone</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">almond</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">options</span><span class="p">.</span><span class="nx">outName</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">outName</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">outName</span><span class="p">;</span>

    <span class="c1">//turning on source maps unless explictly configured</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">=</span> <span class="s1">&#39;uglify2&#39;</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">preserveLicenseComments</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">empty</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">empty</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">config</span><span class="p">.</span><span class="nx">paths</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;empty:&#39;</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">taskName</span> <span class="o">=</span> <span class="s1">&#39;requirejs.&#39;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">outName</span> <span class="o">+</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">postfix</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.options&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="nx">taskName</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerOptimizeLibrary</code> uses <code>grunt-requirejs</code> to produce both optimized
and unoptimized versions of a given library using the r.js optimizer.
If specified, <code>standalone</code> versions of that library can be produced as well
(using almond), resulting in six total files:</p>

<ul>
<li>library.js</li>
<li>library.min.js</li>
<li>library.min.js.map</li>
<li>standalone/library.js</li>
<li>standalone/library.min.js</li>
<li>standaline/library.min.js.map</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerOptimizeLibrary</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">config</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">basePath</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">basePath</span> <span class="o">||</span> <span class="s1">&#39;dist&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">outName</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>

    <span class="c1">//not minified, needs requirejs</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">preserveLicenseComments</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">registerOptimize</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

    <span class="c1">//minified, needs requirejs</span>
    <span class="k">delete</span> <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span><span class="p">;</span>

    <span class="nx">options</span><span class="p">.</span><span class="nx">postfix</span> <span class="o">=</span> <span class="s1">&#39;-min&#39;</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;.min.js&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">registerOptimize</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">standalone</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">delete</span> <span class="nx">options</span><span class="p">.</span><span class="nx">postfix</span><span class="p">;</span>

      <span class="c1">//not minified, standalone with almond.js</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">preserveLicenseComments</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="nx">options</span><span class="p">.</span><span class="nx">postFix</span> <span class="o">=</span> <span class="s1">&#39;-standalone&#39;</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">,</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">registerOptimize</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

      <span class="c1">//minified, standalone with almond.js</span>
      <span class="k">delete</span> <span class="nx">config</span><span class="p">.</span><span class="nx">optimize</span><span class="p">;</span>
      <span class="k">delete</span> <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span><span class="p">;</span>

      <span class="nx">options</span><span class="p">.</span><span class="nx">almond</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">postFix</span> <span class="o">=</span> <span class="s1">&#39;-standalone-min&#39;</span><span class="p">;</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">basePath</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">,</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;.min.js&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">registerOptimize</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerCopyFromDist</code> uses <code>grunt-contrib-copy</code> to copy all files under the
'dist/' folders of a list of specified npm-installed modules.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerCopyFromDist</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">registerCopy</span><span class="p">();</span>

    <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="s1">&#39;lib/vendor&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">modules</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Need to provide list of modules!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">modules</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">expand</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">cwd</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="nx">module</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">),</span>
        <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;**/*&#39;</span><span class="p">],</span>
        <span class="nx">dest</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span>
      <span class="p">});</span>
    <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;copy.from-dist&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">files</span><span class="o">:</span> <span class="nx">files</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerCopyFromBower</code> uses <code>grunt-contrib-copy</code> to copy all files installed
by bower of the form 'bower_components/[module]/[module].js' to 'lib/vendor'.
You can use the <code>bowerSpecialCases</code> hash to override the default expected file
location.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bowerSpecialCases</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">async</span><span class="o">:</span> <span class="s1">&#39;lib/async.js&#39;</span><span class="p">,</span>
    <span class="nx">hoverintent</span><span class="o">:</span> <span class="s1">&#39;jquery.hoverIntent.js&#39;</span><span class="p">,</span>
    <span class="nx">jquery</span><span class="o">:</span> <span class="s1">&#39;dist/jquery.js&#39;</span><span class="p">,</span>
    <span class="nx">labjs</span><span class="o">:</span> <span class="s1">&#39;LAB.min.js&#39;</span><span class="p">,</span>
    <span class="nx">lodash</span><span class="o">:</span> <span class="s1">&#39;dist/lodash.compat.js&#39;</span><span class="p">,</span>
    <span class="nx">requirejs</span><span class="o">:</span> <span class="s1">&#39;require.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;spin.js&#39;</span><span class="o">:</span> <span class="s1">&#39;spin.js&#39;</span><span class="p">,</span>
    <span class="nx">tipsy</span><span class="o">:</span> <span class="s1">&#39;src/jquery.tipsy.js&#39;</span>
  <span class="p">};</span>

  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">;</span>

  <span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerCopyFromBower</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">dirs</span><span class="p">;</span>

    <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="s1">&#39;lib/vendor&#39;</span><span class="p">;</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">||</span> <span class="s1">&#39;bower_components&#39;</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">registerCopy</span><span class="p">();</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">dirs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">source</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
        <span class="s1">&#39;registerCopyFromBower: Couldn\&#39;t load installed bower components.&#39;</span>
      <span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">dirs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">bowerSpecialCases</span><span class="p">[</span><span class="nx">dir</span><span class="p">]</span> <span class="o">||</span> <span class="nx">dir</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">statSync</span><span class="p">(</span><span class="nx">file</span><span class="p">).</span><span class="nx">isFile</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">files</span><span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">))]</span> <span class="o">=</span> <span class="nx">file</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">verbose</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="s1">&#39;Warning: &#39;</span><span class="p">.</span><span class="nx">red</span> <span class="o">+</span> <span class="nx">dir</span> <span class="o">+</span>
         <span class="s1">&#39; bower directory didn\&#39;t contain \&#39;&#39;</span> <span class="o">+</span> <span class="nx">filename</span> <span class="o">+</span> <span class="s1">&#39;\&#39;\n&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">files</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;copy.from-bower&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">files</span><span class="o">:</span> <span class="nx">files</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="p">};</span></div></div></div></div></body></html>