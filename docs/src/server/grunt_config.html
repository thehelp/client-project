<!DOCTYPE html><html lang="en"><head><title>src/server/grunt_config</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="src/server/grunt_config"><meta name="groc-project-path" content="src/server/grunt_config.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/server/grunt_config.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="gruntconfig">GruntConfig</h1>

<p>Configures grunt-based automation for the project. Just create an instance of this
class, passing in <code>grunt</code>, then call <code>standardSetup()</code>.</p>

<p>Registration for specific scenario is in each of the <code>registerXXX()</code> methods below.
It's split out this way to keep related configuration in the same place, since
most scenarios have config points in different parts of the config tree:</p>

<ol>
<li>loading the tasks themselves</li>
<li>task configuration</li>
<li>related watch tasks</li>
<li>related clean tasks</li>
</ol></div></div><div class="code"><div class="wrapper"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">GruntConfig</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span> <span class="o">=</span> <span class="nx">grunt</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">bowerSpecialCases</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">async</span><span class="o">:</span> <span class="s1">&#39;lib/async.js&#39;</span><span class="p">,</span>
    <span class="nx">hoverintent</span><span class="o">:</span> <span class="s1">&#39;jquery.hoverIntent.js&#39;</span><span class="p">,</span>
    <span class="nx">jquery</span><span class="o">:</span> <span class="s1">&#39;dist/jquery.js&#39;</span><span class="p">,</span>
    <span class="nx">labjs</span><span class="o">:</span> <span class="s1">&#39;LAB.min.js&#39;</span><span class="p">,</span>
    <span class="nx">lodash</span><span class="o">:</span> <span class="s1">&#39;dist/lodash.compat.js&#39;</span><span class="p">,</span>
    <span class="nx">requirejs</span><span class="o">:</span> <span class="s1">&#39;require.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;spin.js&#39;</span><span class="o">:</span> <span class="s1">&#39;spin.js&#39;</span><span class="p">,</span>
    <span class="nx">tipsy</span><span class="o">:</span> <span class="s1">&#39;src/jquery.tipsy.js&#39;</span>
  <span class="p">};</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">fs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">GruntConfig</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="commonly-used-methods">Commonly-used Methods</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>standardSetup</code> sets up everything this project provides with the defaults.
An easy one-stop shop.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">standardSetup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">setupTimeGrunt</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerWatch</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">watch</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerEnv</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">env</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerClean</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">clean</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">registerTest</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">test</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerStaticAnalysis</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">staticAnalysis</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerStyle</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">style</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerDoc</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">doc</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">registerConnect</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">connect</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">registerShell</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">shell</span><span class="p">);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>standardDefault</code> installs a 'default' grunt handler (what runs when you just type
'grunt' on the command line) which does what you likely want it to do.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">standardDefault</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;staticanalysis&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;doc&#39;</span><span class="p">]);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="utility-methods">Utility Methods</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>modifiedInLast</code> allows you to limit the scope of any participating task's target
files to the files modified in the last X minutes. X is defined by supplying the
'partial' option on the command line. For example:</p>

<pre><code>grunt watch:doc --partial=2
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">modifiedInLast</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>

  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">minutes</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">updated</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statSync</span><span class="p">(</span><span class="nx">file</span><span class="p">).</span><span class="nx">mtime</span><span class="p">.</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">minutesAgo</span> <span class="o">=</span> <span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">minutes</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">updated</span> <span class="o">&gt;</span> <span class="nx">minutesAgo</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>loadLocalNpm</code> gets around the limitation in <code>grunt.loadNpmTasks</code> - that it always
pulls locally-installed modules. The whole point of this project is to take the
difficulty out of using all of these grunt plugins. This method ensures that
any project using 'thehelp-project' needs only to add 'thehelp-project' as
a dependency, not the various grunt plugins.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadLocalNpm</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">delta</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nx">__dirname</span><span class="p">;</span>
  <span class="nx">delta</span> <span class="o">=</span> <span class="nx">delta</span> <span class="o">||</span> <span class="s1">&#39;../..&#39;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">tasks</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">delta</span><span class="p">,</span> <span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;tasks&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">loadTasks</span><span class="p">(</span><span class="nx">tasks</span><span class="p">);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="specific-scenarios">Specific Scenarios</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setupTimeGrunt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">timeGrunt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;time-grunt&#39;</span><span class="p">);</span>
  <span class="nx">timeGrunt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerWatch</code> sets up watch with no tasks, ready for other registration
functions to add them.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerWatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-watch&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">debounceDelay</span><span class="o">:</span> <span class="mi">200</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerEnv</code> sets up the <code>env</code> task to populate environment variables. By default it
 uses data from 'env.json' in the current working directory (the root of your project).</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerEnv</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-env&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{</span>
    <span class="nx">all</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="s1">&#39;env.json&#39;</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerClean</code> deletes directories as specified in options, or in
three default directories: 'dist,' 'tmp,' and 'public.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerClean</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-clean&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{</span>
    <span class="nx">dist</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;dist/**/*&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">tmp</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;tmp/**/*&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="kr">public</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;public/**/*&#39;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerTest</code> does everything required to get a number of test-related
tasks in place, including the ability to run unit tests whenever a test
or source file is changed.</p>

<p>Several options are supported by this set of tasks:</p>

<ul>
<li>coverage: when truthy, the reporter will be set to 'html-cov', and <code>blanket</code>
will automatically required</li>
<li>reporter: when 'coverage' is not set, you can customize the reporter to anything
you'd like. I prefer 'dot' when running under a watch task, for example.</li>
<li>grep: use this to limit your run to specific tests</li>
<li>bail: use this to cause the mocha run to stop after the first failed test</li>
</ul>

<p><em>Note: the 'partial' option will force you to save the test-side of a given
test target to get the tests to run, since our filter only sees the test
files, not the source files. Even if it did, supplying those files to
mocha would result in no tests run.</em></p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerTest</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*jshint maxcomplexity: 9 */</span>

  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">src</span> <span class="o">||</span> <span class="p">[</span><span class="s1">&#39;src/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;tasks/**/*.js&#39;</span><span class="p">];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-mocha-cli&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;mochacli&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">unit</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;test/unit/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;!test/unit/client/**&#39;</span><span class="p">],</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">integration</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;test/integration/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;!test/integration/client/**&#39;</span><span class="p">],</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">manual</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;test/manual/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;!test/manual/client/**&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">all</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;test/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;!test/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;!test/*/client/**&#39;</span><span class="p">,</span> <span class="s1">&#39;!test/util/*&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">reporter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;html-cov&#39;</span> <span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;reporter&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;spec&#39;</span><span class="p">,</span>
      <span class="nx">require</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="p">[</span><span class="s1">&#39;blanket&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="p">[],</span>
      <span class="nx">grep</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;grep&#39;</span><span class="p">),</span>
      <span class="nx">bail</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;bail&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;watch.unit&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">files</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="s1">&#39;test/unit/**/*.js&#39;</span><span class="p">),</span>
    <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
  <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;watch.integration&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">files</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="s1">&#39;test/integration/**/*.js&#39;</span><span class="p">),</span>
    <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;integration&#39;</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:unit&#39;</span><span class="p">]);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;integration&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:integration&#39;</span><span class="p">]);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:manual&#39;</span><span class="p">]);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-all&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:all&#39;</span><span class="p">]);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;integration&#39;</span><span class="p">]);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerStaticAnalysis</code> sets up two tasks: 'jshint' and 'complexity.' It also sets up the
ability to run both of these whenever any javascript file changes in tne project. Within
the 'jshint' task we create two sub-tasks: 'src' and 'test.' Test has a
frequently-encountered rule turned off.</p>

<p><em>Note: Participates in the 'partial' filtration option.</em></p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerStaticAnalysis</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/*jshint maxcomplexity: 9 */</span>

  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">src</span> <span class="o">||</span> <span class="p">[</span><span class="s1">&#39;src/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;tasks/**/*.js&#39;</span><span class="p">];</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">test</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">test</span> <span class="o">||</span> <span class="p">[</span><span class="s1">&#39;test/**/*.js&#39;</span><span class="p">];</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">all</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">test</span><span class="p">);</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">jshintrc</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">jshintrc</span> <span class="o">||</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../../.jshintrc&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-jshint&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;jshint&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">src</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">test</span><span class="p">,</span>
      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">//&quot;Expected an assignment or function call and instead saw an expression&quot;</span>
        <span class="s1">&#39;-W030&#39;</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">jshintrc</span><span class="p">)</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-complexity&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;complexity&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">all</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">all</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">errorsOnly</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">maintainability</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span>

      <span class="c1">//we&#39;re not using these, so setting high</span>
      <span class="nx">cyclomatic</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
      <span class="nx">halstead</span><span class="o">:</span> <span class="kc">Infinity</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;watch.staticanalysis&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">files</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">all</span><span class="p">,</span>
    <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;staticanalysis&#39;</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;staticanalysis&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;jshint&#39;</span><span class="p">,</span> <span class="s1">&#39;complexity&#39;</span><span class="p">]);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;staticanalysis&#39;</span><span class="p">]);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerStyle</code> sets up one task: 'jscs' with a default set of rules. You can
specify your path to a JSON config file in the second parameter.</p>

<p>Check the <a href="https://github.com/mdevils/node-jscs">jscs readme</a> for more information on
what it does.</p>

<p><em>Note: Participates in the 'partial' filtration option.</em></p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerStyle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">files</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">files</span> <span class="o">||</span>
    <span class="p">[</span><span class="s1">&#39;src/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;tasks/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;test/**/*.js&#39;</span><span class="p">];</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">jscsrc</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">jscsrc</span> <span class="o">||</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../../.jscsrc&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-jscs-checker&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;jscs&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">all</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">files</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">jscsrc</span><span class="p">)</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;watch.style&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">files</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">files</span><span class="p">,</span>
    <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;jscs&#39;</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;jscs&#39;</span><span class="p">]);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerDoc</code> uses <code>groc</code> to process markdown comments in source files into
nice documentation files in HTML. It also uses a custom-developed
<a href="../../tasks/fix_groc_stylesheet.html"><code>fix-groc-stylesheet</code></a> task to do better
than the default groc stylesheet, recopied on every run.</p>

<p><em>Note: Participates in the 'partial' filtration option. Highly recommended,
as groc runs take a long time.</em></p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerDoc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">loadTasks</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../../tasks&#39;</span><span class="p">));</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">all</span> <span class="o">||</span> <span class="p">[</span><span class="s1">&#39;src/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;tasks/**/*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;*.js&#39;</span><span class="p">,</span> <span class="s1">&#39;README.md&#39;</span><span class="p">];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-groc&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;groc&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">all</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">src</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">all</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiedInLast</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">out</span><span class="o">:</span> <span class="s1">&#39;docs/&#39;</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;watch.doc&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">files</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">all</span><span class="p">,</span>
    <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;doc&#39;</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;clean.doc&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;docs/src/**/*&#39;</span><span class="p">,</span> <span class="s1">&#39;docs/tasks/**/*&#39;</span><span class="p">,</span> <span class="s1">&#39;docs/*.html&#39;</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;groc&#39;</span><span class="p">,</span> <span class="s1">&#39;fix-groc-stylesheet&#39;</span><span class="p">]);</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerCopy</code> uses the <code>grunt-contrib-copy</code> task to copy files.
Ensure that you don't call this method with options after configuring
other copy targets, as it will overwrite those other settings.</p>

<pre><code class="javascript">target: {
  files: {
    'target': 'source',
    'dist/mocha.css': 'lib/vendor/mocha.css',
    'dist/harness.js': 'src/client/harness.js'
  }
}
</code></pre>

<p>Or like this:</p>

<pre><code class="javascript">target: {
  files: [{
    expand: true,
    cwd: path.join('node_modules', module, 'dist'),
    src: ['*.js'],
    dest: 'lib/vendor'
  }]
}
</code></pre>

<p>If no options are specified, this method will simply pull in the copy task
for your customization.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerCopy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">copyRegistered</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-copy&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">copyRegistered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerConnect</code> sets up two targets for the <code>grunt-contrib-connect</code>
task, which runs a basic file server. Two different targets are provided:</p>

<ul>
<li>test: On port 3001, this server will stop as soon as the grunt task stop,
which means that it is only useful for grunt-based testing.</li>
<li>keepalive: A server on 3000 that runs until explicitly stopped - good
for active development.</li>
</ul></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerConnect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-connect&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{</span>
    <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="nx">port</span><span class="o">:</span> <span class="mi">3001</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">keepalive</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="nx">port</span><span class="o">:</span> <span class="mi">3000</span><span class="p">,</span>
        <span class="nx">keepalive</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerMocha</code> pulls in <code>grunt-mocha</code> which uses <code>phantomjs</code>
and a custom bridge to run in-browser tests on the command line. You're
just responsible for the collection of URLs to hit. You might consider using
the port 3001 urls available with the <code>connect</code> task above.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerMocha</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">urls</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Need to provide array of urls to registerMocha()!&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">reporter</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reporter</span> <span class="o">||</span> <span class="s1">&#39;spec&#39;</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-mocha&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;mocha&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">urls</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">urls</span><span class="p">,</span>
        <span class="nx">reporter</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reporter</span><span class="p">,</span>
        <span class="nx">run</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerOptimize</code> uses <code>grunt-requirejs</code> to produce both optimized
and unoptimized versions of a given library using the r.js optimizer.
If specified, standalone versions of that library can be produced as well
(using almond), resulting in four total files.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerOptimize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-requirejs&#39;</span><span class="p">);</span>

  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">config</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">outName</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">outName</span> <span class="o">||</span> <span class="nx">name</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">empty</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">empty</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">standalone</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">standalone</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">out</span> <span class="o">||</span> <span class="s1">&#39;dist&#39;</span><span class="p">;</span>

  <span class="c1">//turning on source maps unless explictly configured</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">=</span> <span class="s1">&#39;uglify2&#39;</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">preserveLicenseComments</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">//minified, needs requirejs</span>
  <span class="kd">var</span> <span class="nx">rMin</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
  <span class="nx">rMin</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
  <span class="nx">rMin</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;.min.js&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">empty</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">empty</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">rMin</span><span class="p">.</span><span class="nx">paths</span><span class="p">[</span><span class="nx">module</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;empty:&#39;</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;requirejs.&#39;</span> <span class="o">+</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;-min.options&#39;</span><span class="p">,</span> <span class="nx">rMin</span><span class="p">);</span>

  <span class="c1">//not minified, needs requirejs</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">rMin</span><span class="p">);</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;requirejs.&#39;</span> <span class="o">+</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;.options&#39;</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">standalone</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//minified, standalone with almond.js</span>
    <span class="kd">var</span> <span class="nx">sMin</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
    <span class="nx">sMin</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="nx">sMin</span><span class="p">.</span><span class="nx">almond</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">sMin</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">,</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;.min.js&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;requirejs.&#39;</span> <span class="o">+</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;-standalone-min.options&#39;</span><span class="p">,</span> <span class="nx">sMin</span><span class="p">);</span>

    <span class="c1">//not minified, standalone with almond.js</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cloneDeep</span><span class="p">(</span><span class="nx">sMin</span><span class="p">);</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">generateSourceMaps</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">out</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">out</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">,</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;requirejs.&#39;</span> <span class="o">+</span> <span class="nx">outName</span> <span class="o">+</span> <span class="s1">&#39;-standalone.options&#39;</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerCopyFromDist</code> uses <code>grunt-contrib-copy</code> to copy all files under the
'dist/' folders of a list of specified npm-installed modules.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerCopyFromDist</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">modules</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span> <span class="o">||</span> <span class="s1">&#39;lib/vendor&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">registerCopy</span><span class="p">();</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">modules</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">expand</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">cwd</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;node_modules&#39;</span><span class="p">,</span> <span class="nx">module</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">),</span>
      <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;**/*&#39;</span><span class="p">],</span>
      <span class="nx">dest</span><span class="o">:</span> <span class="nx">target</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;copy.from-dist&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">files</span><span class="o">:</span> <span class="nx">files</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerCopyFromBower</code> uses <code>grunt-contrib-copy</code> to copy all files installed
by bower of the form 'bower_components/[module]/[module].js' to 'lib/vendor'.
You can use the <code>bowerSpecialCases</code> hash to override the default expected file
location.</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerCopyFromBower</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

  <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">dirs</span><span class="p">;</span>

  <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="s1">&#39;lib/vendor&#39;</span><span class="p">;</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">||</span> <span class="s1">&#39;bower_components&#39;</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">registerCopy</span><span class="p">();</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">dirs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">source</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
      <span class="s1">&#39;registerCopyFromBower: Couldn\&#39;t load installed bower components.&#39;</span>
    <span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">dirs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">_this</span><span class="p">.</span><span class="nx">bowerSpecialCases</span><span class="p">[</span><span class="nx">dir</span><span class="p">]</span> <span class="o">||</span> <span class="nx">dir</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_this</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">statSync</span><span class="p">(</span><span class="nx">file</span><span class="p">).</span><span class="nx">isFile</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">files</span><span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">))]</span> <span class="o">=</span> <span class="nx">file</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">verbose</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="s1">&#39;Warning: &#39;</span><span class="p">.</span><span class="nx">red</span> <span class="o">+</span> <span class="nx">dir</span> <span class="o">+</span>
       <span class="s1">&#39; bower directory didn\&#39;t contain \&#39;&#39;</span> <span class="o">+</span> <span class="nx">filename</span> <span class="o">+</span> <span class="s1">&#39;\&#39;\n&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">files</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;copy.from-bower&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">files</span><span class="o">:</span> <span class="nx">files</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>registerShell</code> makes the 'shell' task available if no options are required. Here's an
example of how to add <code>bower install</code> to your grunt tasks:
```javascript
registerShell({
  'bower-install': {
     command: 'bower install',
     options: {
       failOnError: true
     }
   }</p></div></div><div class="code"><div class="wrapper"><span class="c1">// )</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>```</p></div></div><div class="code"><div class="wrapper"><span class="nx">GruntConfig</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerShell</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadLocalNpm</span><span class="p">(</span><span class="s1">&#39;grunt-shell&#39;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></div></div></div></div></body></html>